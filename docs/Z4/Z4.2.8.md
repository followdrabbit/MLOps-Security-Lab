# Z4-2.8 — **Readiness Review, SCDR/ADR & Go/No-Go**

*o carimbo final de governança antes de qualquer “Candidate” virar um artefato governado na Z5*

Esta etapa consolida **evidências técnicas + decisões de risco** em documentos formais e aplica um **checklist de aprovação** (automatizado + humano) para emitir o **Go/No-Go**.
Aqui nascem (ou são atualizados) o **SCDR** (*Security Control Decision Record*) e o **ADR** (*Architecture Decision Record*), além do **Model Card** e dos artefatos de compliance necessários para o setor financeiro.

> Ponto de controle: 2.8 acontece **depois** de Z4-2.4/2.5/2.6 e **em paralelo** à embalagem/assinatura (Z4-2.7). Se algo **não** estiver evidenciado, **não** há promoção.

---

## 1) Objetivo & Escopo

**Objetivo:** transformar resultados técnicos (métricas, higiene, testes adversariais, proveniência) em **decisões auditáveis**, ligadas a **riscos, controles, exceções** e **responsáveis**.
**Escopo:** todos os modelos candidatos que pretendem entrar no **Z5 – Model Registry & Governance**.

---

## 2) Entradas (de onde vêm as evidências)

* **Z4-2.4**: `hygiene_report.json`, `privacy_report.json`, `leakage_checks.json`.
* **Z4-2.5**: `adv_eval.json`, `privacy_eval.json` (MI/inversion/extraction), `security_decision.txt`.
* **Z4-2.6**: `run_id`, `git_sha`, `container_digest`, `dataset@snapshot`, `sbom_ref`, métricas & fairness.
* **Z4-2.7**: `checksums.json`, **assinaturas cosign**, **attestation** (in-toto/SLSA), `model_card.md` (rascunho).

---

## 3) Saídas (documentos e estados produzidos)

* **SCDR** — *Security Control Decision Record*

  * Contém: *risco identificado* → *controle aplicado* → *risco residual* → *aceitação/mitigação* → *responsáveis* → *prazos*.
  * Liga **cada requisito** (NIST/CSA/OWASP/LGPD) ao **controle implementado** (ou justificado).
* **ADR** — *Architecture Decision Record*

  * Justifica escolhas técnicas (ex.: *online vs. batch*, *feature store*, *caching*, *tokenização*).
  * Alternativas consideradas, trade-offs, impacto em *latência/custo/risco*.
* **Model Card** (versão final)

  * Finalidade, dados, público-alvo, *guardrails* de uso, limites, *fairness* e **proibições** (ex.: uso fora do domínio).
* **Checklist de Readiness** (Go/No-Go)

  * Lista de verificação assinada (duas pessoas mín.; *four-eyes*) com evidências linkadas ao **run**.
* **Estado do candidato**

  * `No-Go` (reprova), `Go to Candidate` (aceito para submissão Z5), ou `Go to Staging` (quando acoplado a sandbox de integração).

---

## 4) Checklist de **Readiness** (exemplo — policy-as-code + humana)

### 4.1 Automático (OPA/Rego/pipeline)

* `security_decision == "PASS"` (Z4-2.5).
* **SBOM** presente e sem **CVEs críticos** não aceitos.
* `cosign_sig` válida e **attestation** coerente (git/image/dataset).
* `dataset@snapshot` com **base legal** e **finalidade** compatível (tags do catálogo).
* Métricas ≥ *thresholds* e fairness dentro de **limites** (por subgrupo).
* `model_card.md` preenchido; `checksums.json` íntegro.

### 4.2 Humano (*four-eyes*, papéis sugeridos)

* **Dono do Produto/Área**: validar **finalidade de uso** e impacto de negócio.
* **Segurança/Privacidade**: validar **controles**, **risco residual**, **restrições de uso**.
* (Opcional) **Risco/Compliance**: checagens setoriais (banco/financeiro).

> Resultado: **assinatura** eletrônica do checklist (ex.: comentário aprovado no PR do *manifest* ou “Approve” num formulário).

---

## 5) Estrutura sugerida do **SCDR** (modelo curto)

```
SCDR-ID: BANK.ML.RISK_DEFAULT.2025.r1
Modelo/Versão: risk-default v2 (run_id=..., registry=name:version)
Contexto: decisão para promover modelo de risco de crédito ao estágio Candidate/Staging

Riscos identificados:
  R1 – Membership Inference (MI)              Classificação: ALTO
  R2 – Data Poisoning (clean-label)           Classificação: MÉDIO
  R3 – Prompt Injection (se LLM/RAG)          Classificação: N/A (não aplicável)

Controles aplicados:
  C1 – Limite de confiança + calibragem       R1 ↔ Z4-2.5/4.4
  C2 – Hygiene + PSI baseline + bursts        R2 ↔ Z4-2.4
  C3 – Rate limit + mTLS + ABAC no Z6         MI/Extraction ↔ Z6

Risco residual:
  R1 – BAIXO (Attack AUC=0.53) | Evidência: privacy_eval.json
  R2 – BAIXO (sem outliers/anomalias) | Evidência: hygiene_report.json

Decisão:
  GO → Candidate (submeter Z5) | Condições: Revisar fairness trimestral
Responsáveis: PO: Maria S., Sec: Raphael F.
Data/Validade: 2025-11-12 | Reavaliação: +90 dias
Referências: run_id=..., sbom_ref=..., cosign_sig=..., attestation=...
```

---

## 6) Estrutura sugerida do **ADR** (modelo curto)

```
ADR-012: Serving Online com Inference Gateway + Batch Orchestrator
Status: Accepted
Contexto: reduzir latência p95 ≤ 60ms mantendo controle de segurança
Decisão: serviços online via Inference Gateway (mTLS, ABAC, rate limit);
         batch via orquestrador com SA e acesso RO à Scored Store
Alternativas: serving direto no app (rejeitado por segurança/observabilidade)
Consequências: menor acoplamento, auditoria centralizada, custo de gateway
Links: Z6 design, NetworkPolicies, benchmarks de latência, SCDR correlato
```

---

## 7) Workflow prático (como encaixa no pipeline)

1. **`collect-evidence`**: agrega os artefatos das etapas 2.4/2.5/2.6/2.7 num `readiness_manifest.json`.
2. **`auto-checks (OPA)`**: executa Rego; escreve `auto_readiness.json` (PASS/FAIL + motivos).
3. **`create-records`**: gera **SCDR.md**/**ADR.md** a partir de *templates* preenchidos com os metadados do run.
4. **`four-eyes`**: abre PR com os documentos + `readiness_manifest.json`; exige 2 *approvals*.
5. **`go-no-go`**:

   * **Go** → chama 2.7 para **empacotar/assinar** (se ainda não feito) e submeter ao **Z5**;
   * **No-Go** → cria *issue* com *action items* e bloqueia a promoção.

---

## 8) Exemplo de **Rego** (OPA) para auto-readiness (resumido)

```rego
package readiness

default allow = false

allow {
  input.security_decision == "PASS"
  input.sbom.present
  not input.sbom.has_blocking_cves
  input.signatures.cosign_valid
  input.attestation.present
  input.data.snapshot_present
  input.fairness.ks_diff_max <= 0.12
  input.metrics.auc >= 0.82
}
```

---

## 9) Integrações & rastreabilidade

* **MLflow/Z4-2.6**: SCDR/ADR e o `readiness_manifest.json` são anexados como artefatos do **run**.
* **Z5 Registry**: armazena *hash*/link para SCDR/ADR/Model Card e **estado** (“Candidate/Staging/Approved/Revoked”).
* **Z9**: recebe eventos “`readiness_passed` / `readiness_failed`” com `run_id`, `model_name`, *approvers*.

---

## 10) Riscos × Controles × Frameworks

| Risco                                 | Controles (Z4-2.8)                                                 | Referências                            |
| ------------------------------------- | ------------------------------------------------------------------ | -------------------------------------- |
| Promoção sem evidências               | Checklist auto + **four-eyes**, SCDR/ADR, `security_decision=PASS` | NIST AI RMF (Govern/Manage), NIST SSDF |
| Conformidade opaca (setor financeiro) | Model Card + base legal/finalidade + trilhas Z9                    | LGPD/GDPR, ISO/IEC 23894               |
| Exceções mal geridas                  | SCDR com “condições” e plano; validade/revisão                     | NIST SP 800-53 PM-**/RA-**             |
| Regressão de fairness/segurança       | *Re-certificação* por janela (ex.: 90 dias)                        | CSA AICM (LOG/SEF), OWASP ML/LLM       |

---

## 11) Runbooks (quando dá **No-Go**)

* **Auto-check falhou (OPA)** → revisar motivo; abrir *issue*; repetir 2.4/2.5/2.6; atualizar *policies* se necessário.
* **Aprovação humana pendente** → *reminder* para *approvers*; *SLA* de decisão; *fallback* para comitê de risco.
* **Divergência SCDR ↔ artefatos** → corrigir metadados; re-gerar SCDR/ADR com *templates* sincronizados.
* **Mudança regulatória** → marcar todos candidatos como *hold*; atualizar checklist/policies; reprocessar *batch*.

---

## 12) Frase pronta para entrevista

> “Antes de registrar qualquer modelo, rodo um **Readiness Review**: OPA verifica **evidências técnicas** (higiene, testes adversariais, SBOM, assinaturas, attestation, fairness) e, em seguida, aplico **governança humana** (*four-eyes*). Isso gera **SCDR/ADR**, **Model Card** final e um **Go/No-Go** formal. Sem esse pacote, o modelo **não** vai para o Registry (Z5) — e a decisão fica **auditável** no Z9.”
