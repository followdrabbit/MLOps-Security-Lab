# Z5-2.4 — **Metadados de Governança (Model Card, SCDR, ADR)**

*“o pacote de evidências que explica **o que** o modelo é, **por que** existe, **como** foi feito, **onde** pode (ou não) ser usado e **quais riscos** permanecem”*

---

## 1) Por que existe / Objetivo

Na Z5, além de assinaturas e attestations, exigimos **metadados de governança** para tornar cada versão **explicável, auditável e defensável**. Eles conectam **negócio, risco, compliance e arquitetura** ao artefato técnico:

* **Model Card**: visão funcional/ética/operacional do modelo.
* **SCDR** (*Security Control Decision Record*): decisões de segurança (controles aplicados, não aplicáveis, mitigação, risco residual, STRIDE).
* **ADR** (*Architecture Decision Record*): decisões arquiteturais (trade-offs, alternativas, consequências).

Sem estes três, o Registry **não promove** e a Z6 **não serve**.

---

## 2) O que compõe (visão de alto nível)

### 2.1 Model Card (final)

**Foco:** finalidade, limites, dados, métricas, risco e salvaguardas.
**Conteúdo mínimo:**

* **Identidade**: `model_name`, `version`, *owners* (produto, dados, segurança), contato DPO.
* **Finalidade & Não-Finalidade** (LGPD/GDPR): usos permitidos, usos proibidos.
* **Base legal e políticas de privacidade**: consentimento/legítimo interesse, retenção, data minimization.
* **Origem dos dados e proveniência**: datasets, snapshots, qualidade, *license/terms*.
* **Métricas & SLOs**: qualidade (AUC/F1), latência p95/p99, erro, custo/1k chamadas.
* **Fairness & harm analysis**: grupos, *bias* conhecido, *thresholds* de monitoramento.
* **Guardrails**: limites de saída, *fallbacks*, LLM Gateway (se aplicável).
* **Risco & salvaguardas**: riscos residuais, mitigação técnica/procedimental.
* **Ciclo de vida**: *revalidate_by*, EoS/EoL, *roll-back plan*.
* **Referências**: SCDR, ADR, SBOM, attestation, *policy snapshot*.

### 2.2 SCDR — Security Control Decision Record

**Foco:** por que controles foram **incluídos/excluídos**, como **mitigar** e qual **risco residual** aceito.
**Conteúdo mínimo:**

* **ID único** (padrão do projeto), **título**, **data**.
* **Contexto & escopo**: qual componente/versão/fluxo.
* **Ameaças (STRIDE)** relevantes; vetor de ataque; impacto (CIA/segurança bancária).
* **Controles aplicados** (lista objetiva, *imperativa*).
* **Controles não aplicáveis** (*por quê*) + **mitigações compensatórias** + **TTL/waiver**.
* **Classificação de risco**: inerente → mitigado → **residual** (critério claro).
* **Assinaturas**: Segurança, Produto, Jurídico/Privacidade (quando necessário).
* **Referências**: NIST/OWASP/CSA/ISO, tickets, PRs.

### 2.3 ADR — Architecture Decision Record

**Foco:** decisões estruturais, alternativas e consequências.
**Conteúdo mínimo:**

* **Título & Status** (Proposed/Accepted/Deprecated/Superseded).
* **Contexto**: problema, restrições, requisitos.
* **Decisão**: escolhido vs. alternativas descartadas e **por quê**.
* **Consequências**: prós/cons, *vendor lock-in*, custos, segurança, escalabilidade.
* **Relação com SCDR**: quais princípios/mandates impacta e como são preservados.

---

## 3) Campos obrigatórios (validados por gate)

### 3.1 **Model Card** (metadados mínimos)

| Campo                                    | Descrição                   | Exemplo                                 |
| ---------------------------------------- | --------------------------- | --------------------------------------- |
| `model_name`, `version`                  | Identidade                  | `risk-default`, `v2.3.0`                |
| `owners`                                 | Nome/área/contatos          | `produto@`, `sec@`, `dpo@`              |
| `purpose.allowed` / `purpose.disallowed` | Finalidade e não-finalidade | `concessão de crédito` / `recrutamento` |
| `legal_basis`                            | Base legal LGPD             | `consentimento`                         |
| `data.sources` / `dataset_snapshot`      | Origem & snapshot           | `z3://curated/…@2025-10-28`             |
| `quality.metrics`                        | AUC/F1/KS etc.              | `AUC=0.86`                              |
| `operational.slo`                        | p95/p99/erro/custo          | `p95<=120ms`                            |
| `fairness.monitors`                      | Grupos & *thresholds*       | `ΔAP<=1pp`                              |
| `guardrails`                             | Limites/LLM Gateway         | `score∈[0,1]`                           |
| `risk.residual`                          | Registro resumido           | `Médio (justificativa)`                 |
| `lifecycle.revalidate_by`                | Data de revalidação         | `2026-02-10`                            |

### 3.2 **SCDR** (mínimo)

| Campo                             | Descrição                                          |
| --------------------------------- | -------------------------------------------------- |
| `scdr_id` (único)                 | Padrão: `{vendor}.{dominio}.{modelo}.{ano}.r{rev}` |
| `context`                         | Onde se aplica (Z*, serviço, versão)               |
| `threats_stride`                  | S,T,R,I,D,E relevantes                             |
| `controls_applied`                | Lista imperativa (RBAC, mTLS, etc.)                |
| `controls_not_applicable`         | Por quê + **compensação** + **TTL**                |
| `risk_inherent` → `risk_residual` | Critérios e valores                                |
| `signoff`                         | Segurança/Produto/Privacidade                      |

### 3.3 **ADR** (mínimo)

| Campo              | Descrição                   |
| ------------------ | --------------------------- |
| `adr_id`, `status` | Identificador e status      |
| `context`          | Problema e restrições       |
| `decision`         | Escolha e motivação         |
| `alternatives`     | Avaliação resumida          |
| `consequences`     | Impactos (inclui segurança) |
| `links`            | SCDR/PRs/diagramas          |

---

## 4) Padrão de IDs, versão e rastreabilidade

* **Model Card**: `MC-{model}-{version}` (ex.: `MC-risk-default-v2.3.0`).
* **SCDR**: `{vendor}.{dominio}.{model}.{ano}.r{rev}` (ex.: `BANK.MLOPS.risk-default.2025.r1`).
* **ADR**: `ADR-{seq}` (ex.: `ADR-012`).
* Todos os IDs são **tags** na versão do Registry e **links** no MLflow run.

---

## 5) Templates (prontos para usar)

### 5.1 **Model Card** (Markdown)

```markdown
# Model Card — {{model_name}} v{{version}}
Owners: {{produto}} {{seguranca}} {{dpo}} | Revalidate by: {{revalidate_by}}

## 1. Finalidade
- Permitidos: {{purpose.allowed}}
- Proibidos: {{purpose.disallowed}}
Base legal (LGPD): {{legal_basis}}

## 2. Dados
- Fontes/Snapshots: {{dataset_snapshot}}
- Qualidade/linhagem: {{data_quality}}

## 3. Métricas & SLOs
- Qualidade: {{metrics}}
- Operacionais: p95={{p95}}ms, p99={{p99}}ms, erro={{err}}, custo/1k={{cost}}

## 4. Fairness & Harm
- Grupos: {{groups}}
- Monitores/limiares: {{fairness_thresholds}}
- Limitações conhecidas: {{limits}}

## 5. Guardrails
- Limites de saída: {{output_limits}}
- LLM Gateway (se aplicável): {{llm_policies}}
- Fallback/Degradação: {{fallbacks}}

## 6. Risco & Salvaguardas
- Principais riscos: {{risks}}
- Mitigações: {{mitigations}}
- Risco residual: {{risk_residual}}

## 7. Ciclo de vida
- EoS/EoL: {{eos_eol}}
- Plano de rollback: {{rollback}}

## 8. Referências
SCDR: {{scdr_id}} — ADR: {{adr_id}} — SBOM: {{sbom_ref}} — Attestation: {{attestation_ref}}
```

### 5.2 **SCDR** (YAML front-matter + corpo)

```yaml
id: BANK.MLOPS.risk-default.2025.r1
title: Controles de segurança para modelo risk-default v2.3.0
date: 2025-11-12
applies_to:
  zone: Z4/Z5/Z6
  version: v2.3.0
threats_stride: [Spoofing, Tampering, InformationDisclosure, Elevation]
risk:
  inherent: Alto
  residual: Médio
waiver_ttl: 2026-02-10
signoff:
  security: maria.s
  product: raphael.f
  privacy: dpo@corp
---
## Contexto
...

## Controles aplicados (imperativos)
- Habilitar mTLS entre Gateway e pods de serving.
- Enforce schema JSON no Inference Gateway (reject on fail).
- Validar `policy_digest` no startup do serviço.

## Controles não aplicáveis + Compensação
- DAST contínuo no serviço `X` **não** aplicável (serviço interno sem UI).
  *Compensação:* scans semanais + egress policies estritas. **TTL:** 90 dias.

## Classificação de risco
Critério: ...
Resultado: Inerente=Alto → Residual=Médio (justificativa)
```

### 5.3 **ADR** (Markdown)

```markdown
# ADR-012 — Modelo ONNX assinado + Inference Gateway
Status: Accepted | Date: 2025-11-12

## Contexto
...

## Decisão
Adotar ONNX + assinatura cosign; servir via Inference Gateway com schema enforcement.

## Alternativas
- TorchScript direto (descartada por compatibilidade).
- ONNX sem assinatura (descartada por supply chain).

## Consequências
+ Portabilidade, verificabilidade.
- Build extra e validação no startup.

Relações: SCDR BANK.MLOPS.risk-default.2025.r1 | Diagrama Z5/Z6
```

---

## 6) Gates (Policy-as-Code) para **completude e coerência**

### 6.1 Gate de **completude** (Model Card + SCDR + ADR)

```rego
package registry.governance_min
default ok = false
ok {
  input.model_card.present
  input.scdr.present
  input.adr.present
  input.model_card.legal_basis != ""
  input.model_card.purpose.allowed != []
  input.lifecycle.revalidate_by != ""
}
```

### 6.2 Gate de **coerência** (campos cruzados)

```rego
package registry.governance_consistency
default ok = false
ok {
  input.model_card.version == input.meta.version
  input.model_card.dataset_snapshot == input.attestation.dataset_snapshot
  input.scdr.applies_to.version == input.meta.version
}
```

> **Bloqueia promoção** se faltarem documentos **ou** se houver divergência de campos-chave.

---

## 7) Integrações (Z4/Z5/Z6/Z9)

* **Z4 → Z5**: pipeline anexa Model Card/SCDR/ADR finais ao run e cria **tags** na versão do Registry.
* **Z5 → Z6**: `release_manifest.json` referencia **hash** do Model Card (opcional) e IDs de SCDR/ADR.
* **Z9**: dashboards incluem **links** dos documentos por versão + alertas de **revalidação vencida**.

---

## 8) Riscos × Controles × Frameworks

| Risco                            | Controle (metadado)                                     | Framework                               |
| -------------------------------- | ------------------------------------------------------- | --------------------------------------- |
| Uso indevido / finalidade errada | Model Card: `purpose.allowed/disallowed`, `legal_basis` | **LGPD/GDPR** (finalidade, minimização) |
| Opacidade do modelo              | Model Card completo + ADR                               | **ISO/IEC 23894** (IA responsável)      |
| Risco não declarado              | SCDR (rastreável) + residual                            | **NIST AI RMF** (Govern/Manage)         |
| Exceções permanentes             | SCDR com **TTL/waiver**                                 | **CSA AICM**, **NIST 800-53** (RA/PL)   |
| Drift sem dono                   | Model Card: `revalidate_by`, SLOs/monitores             | **SRE / NIST AI RMF**                   |
| Auditoria fraca                  | IDs, links, hashes, trilhas no Registry                 | **NIST AU-** / **CSA CCM (LOG)**        |

---

## 9) Runbooks (falhas típicas)

* **Falta Model Card/SCDR/ADR** → Gate nega **Promote**; abrir tarefa; anexar; reexecutar pipeline.
* **Divergência de snapshot** (`dataset_snapshot` diferente) → revisar attestation/Model Card; corrigir tags.
* **Waiver/SCDR vencido** → Gate de **Expiry** aciona *HOLD*; renovar controle ou substituir por equivalente.
* **Finalidade LGPD inconsistente** com rota de consumo → bloquear *startup*; ajustar `purpose.disallowed` ou contratos de API.

---

## 10) Frase pronta (entrevista)

> “No Registry, além de assinatura e attestation, eu **exijo** Model Card, **SCDR** e **ADR**. O Card define **finalidade, base legal, métricas, fairness e guardrails**; o **SCDR** registra controles **aplicados/não aplicáveis** com **mitigações e risco residual** (STRIDE), e o **ADR** explica as decisões técnicas. **Gates Rego** checam **completude e coerência** (ex.: `dataset_snapshot`, `revalidate_by`). Sem esse pacote de governança, a versão **não promove** e a Z6 **não carrega**.”
