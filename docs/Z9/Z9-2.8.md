# Z9-2.8 — Post-Incident Review (PIR), Lições Aprendidas & Melhoria Contínua

↩️ Voltar: [Z9 — Monitoring, Observability & Audit](./Z9-index.md) · Relacionados: Z9-2.6 (Auditoria/Evidence), Z9-2.7 (Alerting/On-Call), Z8-2.6 (SIEM/UEBA/SOAR), Z5 (Governança de Modelos)

> **Resumo**: Define o processo **blameless** de pós-incidente para eventos **operacionais** e **de segurança**. Usa evidências (Z9-2.6), telemetria (Z9-2.1/2/3), UEBA/Drift (Z9-2.4/2.5) e alertas (Z9-2.7) para **encontrar causas de origem**, **corrigir lacunas** de controle e **atualizar políticas, SLOs e runbooks**. Fecha o ciclo de melhoria contínua (Plan-Do-Check-Act) do MLOps Security Lab.

---

## 1) Objetivos & Escopo

**Objetivos**

* Estabelecer um **processo repetível** de análise pós-incidente (PIR) com foco em **prevenção**.
* Capturar **lições aprendidas**, **ações de follow-up** e **mudanças de controle** (Z1–Z8).
* Evidenciar **conformidade** e **rastreabilidade** das decisões (Z9-2.6 / Z8-2.8).

**Escopo**

* Incidentes **S1–S3** (operacionais e de segurança) envolvendo ingestão (Z1), dados (Z2/Z3), treino/registro (Z4/Z5), serving/LLM (Z6), consumo (Z7) e serviços de segurança (Z8).
* **Quase-incidentes** (near misses) com alto potencial de impacto.

---

## 2) Entradas (inputs) do PIR

* **Evidence bundle** do incidente (Z9-2.6): eventos, *hash-chain*, assinaturas, aprovações (Z5), *attestations* (SLSA/SSDF).
* **Timeline** reconstruída a partir de **traces** (Z9-2.3) + tickets SOAR/ITSM.
* **Métricas & alertas** (Z9-2.2/2.7): burn rate, latência p95/p99, custo, *deny* OPA/WAF, DLP hits.
* **Sinais de segurança** (Z9-2.5): UEBA, abuso de API/LLM, exfil/ prompt-injection.
* **Sinais de modelo** (Z9-2.4): PSI/KS, score drift, fairness (se aplicável).

---

## 3) Processo (blameless PIR)

1. **Kick-off (≤ 48h do encerramento)**

   * Reunir **Incident Commander**, donos técnicos (Z1…Z8), SRE/SOC e *stakeholders*.
   * Fixar **objetivo** (o quê prevenir), **escopo**, **linha do tempo** e **prazos**.

2. **Reconstrução factual**

   * Consolidar timeline a partir de **trace_id/run_id**, tickets, chat/war-room.
   * Vincular **decisões de política** (policy_digest), **swap de versão** (Z5) e **mudanças de infra** (IaC/CI).

3. **Análise de causa (RCM)**

   * **5 Whys**, **Fishbone**, **fault tree**. Classificar causa em:

     * **Controles** (WAF/AuthZ/OPA/DLP/logs),
     * **Processos** (on-call, comunicação, runbook),
     * **Mudanças** (deploy, feature flags, política),
     * **Dados/Modelos** (drift, fonte, feature pipeline),
     * **Fornecedores** (LLM/API externa).

4. **Ações corretivas & preventivas (CAPA)**

   * **Hardening** (ex.: ajustar rate-limit, reforçar mTLS/OPA, bloquear rota).
   * **Mudanças de modelo/dados** (ex.: *rollback*, *shadow/canary*, recalibração).
   * **Processos** (ex.: atualizar *playbook*, treinar equipe, ajustar SLO/limiares).
   * **Evidências**: criar tarefas com **owner, due date, impacto e métrica de verificação**.

5. **Aprovação & publicação**

   * Revisão por **governança** (Z5/Z8-2.8). Assinar o relatório e arquivar no **Evidence Store** (WORM).
   * Criar **card “Lições Aprendidas”** e **KEDB** (Base de Erros Conhecidos) correlacionada.

6. **Follow-up**

   * Revisões de 30/60/90 dias para checar **efetividade** e **não-recorrência**.
   * Atualizar **documentos** (SCDR/ADR, runbooks, políticas OPA, SLOs).

---

## 4) Artefatos (saídas)

* **Relatório PIR** (versãoada, assinada, WORM).
* **Lista CAPA** priorizada (RICE/WSJF) com *owners* e *deadlines*.
* **Atualizações** em:

  * **Políticas** (OPA/Rego), **limiares** (Prometheus), **WAF**/IAM/DLP.
  * **Runbooks/Playbooks** (SOAR), **SLOs**, **diagramas Z0–Z9**.
* **KEDB** (Known Error Database) com sintomas, *workaround*, *fix* definitivo.

---

## 5) Template de Relatório (Markdown)

```markdown
# Post-Incident Review — <ID>/<Título>
Data do Incidente: <YYYY-MM-DD> | Severidade: S1/S2/S3 | Serviços: Z?

## 1. Resumo executivo
Impacto, duração, clientes/tenants afetados, custo aproximado.

## 2. Linha do tempo (UTC)
- 12:03: alerta S1 (latência p99)
- 12:05: bloqueio WAF (rule_id=…)
- 12:07: rollback modelo churn v2.3→v2.2
- ...

## 3. Sinais & Evidências
- Traces: `trace_id=…`
- Métricas/Alertas: gráficos/links
- Evidence bundle: link/sha256
- Decisões de política (policy_digest=…)

## 4. Causas (RCM)
Raiz técnica, processos, controles, fornecedores.

## 5. Ações (CAPA)
| Ação | Tipo | Owner | Due | Métrica de sucesso |
|---|---|---|---|---|
| Ajustar rate-limit rota /api/llm | Controle | SRE | 2025-01-10 | p95 < 800ms |

## 6. Lições aprendidas
O que funcionou, o que falhou, mudanças de SLO/runbook.

## 7. Aprovação & Encerramento
Assinaturas digitais, data, evidência de validação.
```

---

## 6) Métricas de eficácia (PIR)

* **Recorrência** (30/60/90d): meta = 0.
* **Lead time** para CAPA crítica: ≤ 7–14 dias.
* **Aderência** à linha do tempo e anexos (≥ 95% com evidence link).
* **Redução** de **MTTD/MTTR** e **alert fatigue** após mudanças.

---

## 7) Riscos × Controles × Frameworks

| Risco                            | Controles neste módulo                                    | Conexões                           |
| -------------------------------- | --------------------------------------------------------- | ---------------------------------- |
| Recorrência de incidentes        | Processo PIR formal, CAPA rastreável, follow-up 30/60/90d | Z9-2.7 (alertas), Z8-2.6 (SOAR)    |
| Lacunas de evidência             | Evidence bundle obrigatório, WORM, hash-chain             | Z9-2.6, Z8-2.8                     |
| Mudanças não institucionalizadas | Atualizar políticas OPA, SLOs, runbooks, diagramas        | Z8-2.4, Z9-2.7                     |
| Conformidade fraca               | Relatório assinado, retenção, auditoria periódica         | NIST AU/IR; CSA GRC/STA; SSDF/SLSA |

> **Referenciais**: NIST SP 800-61 (*Computer Security Incident Handling*), NIST SP 800-53 (AU/IR/CP), práticas **SRE** (post-mortem *blameless*), **CSA CCM** (GRC/LOG/SEF), SSDF/SLSA (evidências supply chain).

---

## 8) Checklists

**Antes do go-live**

* [ ] Modelo de **Relatório PIR** publicado no repositório.
* [ ] Integração SOAR → criação automática de **skeleton** do PIR com evidências.
* [ ] Política de **prazo** (S1≤48h, S2≤5d, S3≤10d) e de **aprovação**.

**Operação**

* [ ] Abrir PIR para **todo S1/S2** e S3 relevante.
* [ ] Acompanhar CAPAs até **done** (SLA por severidade).
* [ ] Rodar **table-top** trimestral com casos LLM/GenAI (abuso, exfil, drift).

---

## 9) Frases prontas (entrevista)

* “Conduzo **PIR blameless** com **evidence bundles** assinados (WORM/hash-chain) e **CAPA** rastreável; toda mudança retorna para **políticas/SLIs/SLOs**.”
* “Fecho o ciclo **Z9 → Z8/Z5** atualizando **OPA/Rego**, *runbooks* e **model governance**; monitoro **recorrência** e **redução de MTTR**.”
* “Para LLM/GenAI, incluo casos de **prompt-injection/exfil/custo** e **drift crítico**, com *shadow/canary/rollback* automatizados.”
